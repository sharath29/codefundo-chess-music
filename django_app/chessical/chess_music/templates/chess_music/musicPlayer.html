<!DOCTYPE html>
{% load static %}
<html>
<head>
  <meta charset="utf-8">
  <title>Chessboard</title>
  <script src="{% static "chess_music/Tone.js" %}"></script>
</head>
<body>
{{ game }}
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBoFfC1va0c9vhgSbVntIWzDC-jtxVV6HI",
    authDomain: "chess-app-cbfb0.firebaseapp.com",
    databaseURL: "https://chess-app-cbfb0.firebaseio.com",
    projectId: "chess-app-cbfb0",
    storageBucket: "chess-app-cbfb0.appspot.com",
    messagingSenderId: "1089239373610"
  };
  firebase.initializeApp(config);
</script>
<script>
  var interval = 0.2
var synth = new Tone.Sampler({
      'A0' : 'A0.[mp3|ogg]',
      'C1' : 'C1.[mp3|ogg]',
      'D#1' : 'Ds1.[mp3|ogg]',
      'F#1' : 'Fs1.[mp3|ogg]',
      'A1' : 'A1.[mp3|ogg]',
      'C2' : 'C2.[mp3|ogg]',
      'D#2' : 'Ds2.[mp3|ogg]',
      'F#2' : 'Fs2.[mp3|ogg]',
      'A2' : 'A2.[mp3|ogg]',
      'C3' : 'C3.[mp3|ogg]',
      'D#3' : 'Ds3.[mp3|ogg]',
      'F#3' : 'Fs3.[mp3|ogg]',
      'A3' : 'A3.[mp3|ogg]',
      'C4' : 'C4.[mp3|ogg]',
      'D#4' : 'Ds4.[mp3|ogg]',
      'F#4' : 'Fs4.[mp3|ogg]',
      'A4' : 'A4.[mp3|ogg]',
      'C5' : 'C5.[mp3|ogg]',
      'D#5' : 'Ds5.[mp3|ogg]',
      'F#5' : 'Fs5.[mp3|ogg]',
      'A5' : 'A5.[mp3|ogg]',
      'C6' : 'C6.[mp3|ogg]',
      'D#6' : 'Ds6.[mp3|ogg]',
      'F#6' : 'Fs6.[mp3|ogg]',
      'A6' : 'A6.[mp3|ogg]',
      'C7' : 'C7.[mp3|ogg]',
      'D#7' : 'Ds7.[mp3|ogg]',
      'F#7' : 'Fs7.[mp3|ogg]',
      'A7' : 'A7.[mp3|ogg]',
      'C8' : 'C8.[mp3|ogg]'
    }, {
      'release' : 1,
      'baseUrl' : "{% static 'chess_music/audio/salamander/' %}"
    }).toMaster();




function generateSound(from,to){
  var time = Tone.context.currentTime
  var temp = from[0]
  var count = -1
  if(from[1]<to[1]){
    for(i=from[1]-1;i<to[1];++i){
      count = count + 1
      if(from[0] < to[0]){
        if(temp < to[0])
          temp = (String.fromCharCode(from[0].charCodeAt()+count))
      }
      else if(from[0] > to[0]){
        if(temp > to[0])
          temp = (String.fromCharCode(from[0].charCodeAt()-count))
      }
      var move = temp.toUpperCase()+i.toString()
      if(move[0] == "H") move = "A" + (i+1)
      if(i<3)
        synth.triggerAttackRelease(move, 0.3, time+=interval)
      else if(i<6)
        synth.triggerAttackRelease(move, 0.2, time+=interval)
      else
        synth.triggerAttackRelease(move, 0.1, time+=interval)
    }
  }
  else if(from[1]>to[1]){
    for(i=from[1]-1;i>=to[1]-1;--i){
      count = count + 1
      if(from[0] < to[0]){
        if(temp < to[0])
          temp = (String.fromCharCode(from[0].charCodeAt(0)+count))
      }
      else if(from[0] > to[0]){
        if(temp > to[0])
          temp = (String.fromCharCode(from[0].charCodeAt(0)-count))
      }
      var move = temp.toUpperCase()+i.toString()
      if(move[0] == "H") move = "A" + (i+1)
      if(i>=0 && i<3)
        synth.triggerAttackRelease(move, 0.3, time+=interval)
      else if(i>=3 && i<6)
        synth.triggerAttackRelease(move, 0.2, time+=interval)
      else
        synth.triggerAttackRelease(move, 0.1, time+=interval)
    }
  }
  else{
    tempNum = Number(from[1])
    if(from[0] < to[0]){
      for(i=from[0].charCodeAt();i<=to[0].charCodeAt();++i){
        count = count + 1
        temp = (String.fromCharCode(from[0].charCodeAt(0)+count))
        var move = temp.toUpperCase()+String.fromCharCode(from[1].charCodeAt(0)-1)
        if(move[0] == "H") move = "A" + String.fromCharCode(from[1].charCodeAt(0))
        if(tempNum>=0 && tempNum<3)
          synth.triggerAttackRelease(move, 0.3, time+=interval)
        else if(tempNum>=3 && tempNum<6)
          synth.triggerAttackRelease(move, 0.2, time+=interval)
        else
          synth.triggerAttackRelease(move, 0.1, time+=interval)
      }
    }
    else{
      for(i=from[0].charCodeAt();i>=to[0].charCodeAt();--i){
        count = count + 1
        temp = (String.fromCharCode(from[0].charCodeAt(0)-count))
        var move = temp.toUpperCase()+String.fromCharCode(from[1].charCodeAt(0)-1)
        if(move[0] == "H") move = "A" + String.fromCharCode(from[1].charCodeAt(0))
        if(tempNum>=0 && tempNum<3)
          synth.triggerAttackRelease(move, 0.3, time+=interval)
        else if(tempNum>=3 && tempNum<6)
          synth.triggerAttackRelease(move, 0.2, time+=interval)
        else
          synth.triggerAttackRelease(move, 0.1, time+=interval)  

      }
    }
  }
}


var list = []
var firebaseSound = firebase.database().ref();
		firebaseSound.child({{ game }}).on('value',function(datasnapshot){
  var len = datasnapshot.child("length").val()
  for(var i=0;i<len;++i){
    console.log(datasnapshot.child(i).val())
    list.push(datasnapshot.child(i).val())
  }
  console.log(list)
  console.log("loaded")
    var time = Tone.context.currentTime
  for(let i=0;i<list.length;++i){
    console.log(i)
    var from = list[i].split(",")[0]
    var to = list[i].split(",")[1]
    var temp = from[0]
    var count = -1
    if(from[1]<to[1]){
      for(let i=from[1]-1;i<to[1];++i){
        count = count + 1
        if(from[0] < to[0]){
          if(temp < to[0])
            temp = (String.fromCharCode(from[0].charCodeAt()+count))
        }
        else if(from[0] > to[0]){
          if(temp > to[0])
            temp = (String.fromCharCode(from[0].charCodeAt()-count))
        }
        let move = temp.toUpperCase()+i.toString()
        if(move[0] == "H") move = "A" + (i+1)
        if(i<3)
          synth.triggerAttackRelease(move, 0.3, time+=interval)
        else if(i<6)
          synth.triggerAttackRelease(move, 0.2, time+=interval)
        else
          synth.triggerAttackRelease(move, 0.1, time+=interval)
      }
    }
    else if(from[1]>to[1]){
      for(let i=from[1]-1;i>=to[1]-1;--i){
        count = count + 1
        if(from[0] < to[0]){
          if(temp < to[0])
            temp = (String.fromCharCode(from[0].charCodeAt(0)+count))
        }
        else if(from[0] > to[0]){
          if(temp > to[0])
            temp = (String.fromCharCode(from[0].charCodeAt(0)-count))
        }
        let move = temp.toUpperCase()+i.toString()
        if(move[0] == "H") move = "A" + (i+1)
        if(i>=0 && i<3)
          synth.triggerAttackRelease(move, 0.3, time+=interval)
        else if(i>=3 && i<6)
          synth.triggerAttackRelease(move, 0.2, time+=interval)
        else
          synth.triggerAttackRelease(move, 0.1, time+=interval)
      }
    }
    else{
      tempNum = Number(from[1])
      if(from[0] < to[0]){
        for(let i=from[0].charCodeAt();i<=to[0].charCodeAt();++i){
          count = count + 1
          temp = (String.fromCharCode(from[0].charCodeAt(0)+count))
          let move = temp.toUpperCase()+String.fromCharCode(from[1].charCodeAt(0)-1)
          if(move[0] == "H") move = "A" + String.fromCharCode(from[1].charCodeAt(0))
          if(tempNum>=0 && tempNum<3)
            synth.triggerAttackRelease(move, 0.3, time+=interval)
          else if(tempNum>=3 && tempNum<6)
            synth.triggerAttackRelease(move, 0.2, time+=interval)
          else
            synth.triggerAttackRelease(move, 0.1, time+=interval)
        }
      }
      else{
        for(let i=from[0].charCodeAt();i>=to[0].charCodeAt();--i){
          count = count + 1
          temp = (String.fromCharCode(from[0].charCodeAt(0)-count))
          let move = temp.toUpperCase()+String.fromCharCode(from[1].charCodeAt(0)-1)
          if(move[0] == "H") move = "A" + String.fromCharCode(from[1].charCodeAt(0))
          if(tempNum>=0 && tempNum<3)
            synth.triggerAttackRelease(move, 0.3, time+=interval)
          else if(tempNum>=3 && tempNum<6)
            synth.triggerAttackRelease(move, 0.2, time+=interval)
          else
            synth.triggerAttackRelease(move, 0.1, time+=interval)  

        }
      }
    }
  }
});

</script>

</body>
</html>
